<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> AI Medical Agent</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="chat-container">
        <h2 class="text-center mb-4">AI Medical Agent</h2>
        <div class="chat-box d-flex flex-column">
            {% for item in history %}
            <div class="d-flex justify-content-end">
                <div class="message user-msg">
                    {{ item.query }}
                </div>
            </div>
            <div class="d-flex justify-content-start">
                <div class="message bot-msg">
                    {{ item.answer }}
                </div>
            </div>
            {% endfor %}
            {% if not history %}
            <div class="text-center text-muted">Ask about medicines, dosage, alternatives...</div>
            {% endif %}
        </div>
        <form method="POST" class="d-flex">
            <input type="text" name="query" class="form-control me-2" placeholder="Type your question..." required>
            <button type="submit" class="btn send-btn">Send</button>
        </form>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.querySelector('form');
            const chatBox = document.querySelector('.chat-box');
            const input = document.querySelector('input[name="query"]');
            const placeholder = document.querySelector('.text-center.text-muted');

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const query = input.value.trim();
                if (!query) return;

                // Remove placeholder if exists
                if (placeholder) placeholder.remove();

                // Append user message
                const userDiv = document.createElement('div');
                userDiv.className = 'd-flex justify-content-end';
                userDiv.innerHTML = `<div class="message user-msg">${query}</div>`;
                chatBox.appendChild(userDiv);

                // Append loading
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'd-flex justify-content-start';
                loadingDiv.innerHTML = `<div class="message bot-msg loading-msg">Bot is thinking...</div>`;
                chatBox.appendChild(loadingDiv);

                input.value = '';
                chatBox.scrollTop = chatBox.scrollHeight;

                // Send request
                try {
                    const response = await fetch('/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        body: new URLSearchParams({ query })
                    });
                    const data = await response.json();
                    loadingDiv.innerHTML = `<div class="message bot-msg">${data.answer}</div>`;
                } catch (error) {
                    loadingDiv.innerHTML = `<div class="message bot-msg">Error: Unable to get response.</div>`;
                }
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        });
    </script>
</body>
</html>
